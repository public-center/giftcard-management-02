<table
  st-table="displayData.display"
  st-safe-src="displayData.safe"
  on-filter="onFilter"
  class="table table-striped activity-table">
  <thead>
  <tr>
    <th st-sort="created_date">Date Purchased</th>
    <th st-sort="batch">Batch #</th>
    <th st-sort="companyName" ng-if="admin">Company Name</th>
    <th st-sort="storeName">Store Name</th>
    <th st-sort="retailer_name">Retailer</th>
    <th st-sort="card_number">Card #</th>
    <th st-sort="pin_code">PIN</th>
    <th st-sort="balance">Balance</th>
    <th st-sort="smpRate" ng-if="admin">SMP Rate</th>
    <th st-sort="cqPaid" ng-if="revised">CQ Paid</th>
    <th st-sort="sold_for" ng-if="revised">SMP Paid</th>
    <th st-sort="verifiedBalance">Verified Balance</th>
    <th st-sort="buyRate" ng-if="corporate">Buy Rate</th>
    <th st-sort="buyAmount" ng-if="corporate">Buy Amount</th>
    <th st-sort="sellRateDisplay" ng-if="corporate">Sell Rate</th>
    <th st-sort="saleAfterMargin" ng-if="corporate">Sell Amount</th>
    <th st-sort="serviceFee" ng-if="admin">Service Fee</th>
    <th st-sort="netAmount">Net Amt</th>
    <th st-sort="margin" ng-if="corporate">Margin</th>
    <th st-sort="type">Type</th>
    <th st-sort="sold_to" ng-if="revised">SMP</th>
    <th st-sort="activityStatus" ng-if="admin">Ship Status</th>
    <th st-sort="buyerShipStatus" ng-if="corporate">Ship Status</th>
    <th st-sort="paidStatus" ng-if="admin && !revised">Paid Status</th>
    <th st-sort="ach" ng-if="admin && !revised">ACH</th>
    <th st-sort="orderNumber" ng-if="revised">Order #</th>
    <th st-sort="smpAch" ng-if="revised">SMP ACH</th>
    <th st-sort="cqAch" ng-if="revised">CQ ACH</th>
    <th st-sort="cqAch" ng-if="corporate">CQ ACH</th>
  </tr>
  <tr>
    <th>
      <input st-search="created_date" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="batch" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="admin">
      <input st-search="companyName" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="storeName" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="retailer_name" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="card_number" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="pin_code" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="balance" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="admin">
      <input st-search="smpRate" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="revised">
      <input st-search="cqPaid" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="revised">
      <input st-search="sold_for" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="verifiedBalance" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="corporate">
      <input st-search="buyRate" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="corporate">
      <input st-search="buyAmount" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="corporate">
      <input st-search="sellRateDisplay" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="corporate">
      <input st-search="saleAfterMargin" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="admin">
      <input st-search="serviceFee" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="netAmount" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="corporate">
      <input st-search="margin" class="input-sm form-control" type="search"/>
    </th>
    <th>
      <input st-search="type" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="revised">
      <input st-search="sold_to" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="admin || corporate">
      <input st-search="activityStatus" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="admin && !revised">
      <input st-search="paidStatus" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="admin && !revised">
      <input st-search="ach" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="revised">
      <input st-search="orderNumber" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="revised">
      <input st-search="smpAch" class="input-sm form-control" type="search"/>
    </th>
    <th ng-if="revised || corporate">
      <input st-search="cqAch" class="input-sm form-control" type="search"/>
    </th>
  </tr>
  </thead>
  <tbody>
  <tr ng-if="displayData.safe.length && admin && !revised">
    <td><strong>Mass Update</strong></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td ng-if="revised"></td>
    <td><div ng-if="admin"><input ng-model="ctrl.displayData.mass.verifiedBalance"></div></td>
    <td></td>
    <td ng-if="revised"></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td ng-if="admin">
      <select ng-model="ctrl.displayData.mass.activityStatus" ng-click="ctrl.preventDefault($event)">
        <option value="shipped">
          Shipped
        </option>
        <option value="received">
          Received
        </option>
      </select>
    </td>
    <td>
      <select ng-model="ctrl.displayData.mass.paidStatus" ng-if="admin" ng-click="ctrl.preventDefault($event)">
        <option value="smpUnpaid">
          SMP Unpaid
        </option>
        <option value="smpPaid">
          SMP Paid
        </option>
        <option value="cqPaid">
          CQ Paid
        </option>
      </select>
    </td>
    <td><div ng-if="admin"><input ng-model="ctrl.displayData.mass.achNumber" ng-click="ctrl.preventDefault($event)"></div></td>
  </tr>
  <tr ng-repeat="row in displayData.display" select-row="row" ctrl="ctrl" ng-paste="paste({contents: $event})">
    <td>{{row.created_date}}</td>
    <td>{{row.batch}}</td>
    <td ng-if="admin">{{row.companyName}}</td>
    <td>{{row.storeName}}</td>
    <td>{{row.retailer_name}}</td>
    <td>{{row.card_number}}</td>
    <td>{{row.pin_code}}</td>
    <td>{{row.balance | currency}}</td>
    <td ng-if="admin">{{row.smpRate}}</td>
    <td ng-if="revised">{{row.cqPaid | currency}}</td>
    <td ng-if="revised">{{row.sold_for | currency}}</td>
    <td>
      <div ng-hide="row.missingGcmgr" ng-if="admin">
        <input ng-model="row.verifiedBalance" ng-change="setValue({row: row, type: 'verifiedBalance'})" ng-click="ctrl.preventDefault($event)">
      </div>
      <div ng-hide="row.missingGcmgr" ng-if="corporate && row.verifiedBalance">
        {{row.verifiedBalance | currency}}
      </div>
      <div ng-hide="row.missingGcmgr" ng-if="corporate && !row.verifiedBalance"></div>
    </td>
    <td ng-if="corporate">{{row.buyRate | number:2}}%</td>
    <td ng-if="corporate">{{row.buyAmount | currency}}</td>
    <td ng-if="corporate">{{row.sellRateDisplay | number:2}}%</td>
    <td ng-if="corporate">{{row.saleAfterMargin | currency:"$":3}}</td>
    <td ng-if="admin">{{row.serviceFee | currency:"$":4}}</td>
    <td>{{row.netAmount | currency:"$":3}}</td>
    <td ng-if="corporate && row.margin > 0">{{row.margin | number:2}}%</td>
    <td ng-if="corporate && !row.margin || row.margin < 0"></td>
    <td>{{row.type}}</td>
    <td ng-if="revised">{{row.sold_to}}</td>
    <td ng-if="revised">
      <select ng-model="row.activityStatus" ng-change="setValue({row: row, type: 'activityStatus'})" ng-click="ctrl.preventDefault($event)">
        <option value="notShipped">
          Not shipped
        </option>
        <option value="shipped">
          In transit to CQ
        </option>
        <option value="receivedCq">
          Received by CQ
        </option>
        <option value="sentToSmp">
          Sent to SMP
        </option>
        <option value="receivedSmp">
          Received by SMP
        </option>
        <option value="rejected">
          Rejected by CQ
        </option>
        <option value="needsAttention">
          Needs Attention
        </option>
      </select>
    </td>
    <td ng-if="corporate">{{row.activityStatus}}</td>
    <td ng-if="admin && !revised">
      <select ng-hide="row.missingGcmgr" ng-change="setValue({row: row, type: 'paidStatus'})" ng-model="row.paidStatus" ng-click="ctrl.preventDefault($event)">
        <option value="smpUnpaid">
          SMP Unpaid
        </option>
        <option value="smpPaid">
          SMP Paid
        </option>
        <option value="cqPaid">
          CQ Paid
        </option>
      </select>
    </td>
    <td ng-if="admin && !revised">
      <div ng-hide="row.missingGcmgr">
        <input ng-model="row.achNumber" ng-change="setValue({row: row, type: 'achNumber'})" ng-if="admin" ng-click="ctrl.preventDefault($event)">
        <div ng-if="corporate">{{row.achNumber}}</div>
      </div>
    </td>
    <!--Order number-->
    <td ng-if="revised">
      <div>
        <input ng-model="row.orderNumber" ng-change="setValue({row: row, type: 'orderNumber'})" ng-click="ctrl.preventDefault($event)">
      </div>
    </td>
    <!--SMP ACH-->
    <td ng-if="revised">
      <div>
        <input ng-model="row.smpAch" ng-change="setValue({row: row, type: 'smpAch'})" ng-click="ctrl.preventDefault($event)">
      </div>
    </td>
    <!--CQ ACH-->
    <td ng-if="revised">
      <div>
        <input ng-model="row.cqAch" ng-change="setValue({row: row, type: 'cqAch'})" ng-click="ctrl.preventDefault($event)">
      </div>
    </td>
    <td ng-if="corporate">{{row.cqAch}}</td>
  </tr>
  <tr ng-if="displayData.safe.length">
    <td><strong>PAGE TOTALS</strong></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td ng-if="revised"></td>
    <td>{{totals.pageTotal.balance | currency}}</td>
    <td ng-if="revised"></td>
    <td ng-if="revised">{{totals.pageTotal.cqPaid | currency}}</td>
    <td ng-if="revised">{{totals.pageTotal.sold_for | currency}}</td>
    <td>{{totals.pageTotal.verifiedBalance | currency}}</td>
    <td ng-if="!revised"></td>
    <td ng-if="admin && !revised"></td>
    <td ng-if="corporate">{{totals.pageTotal.buyAmount | currency}}</td>
    <td ng-if="corporate"></td>
    <td ng-if="corporate">{{totals.pageTotal.saleAfterMargin | currency}}</td>
    <td ng-if="admin">{{totals.pageTotal.serviceFee | currency}}</td>
    <td>{{totals.pageTotal.netAmount | currency}}</td>
    <td ng-if="corporate"></td>
    <td></td>
    <td ng-if="revised"></td>
    <td></td>
    <td ng-if="!revised"></td>
    <td ng-if="revised"></td>
    <td ng-if="revised"></td>
    <td ng-if="revised"></td>
  </tr>
  <tr ng-if="displayData.safe.length">
    <td><strong>GRAND TOTALS</strong></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td ng-if="revised"></td>
    <td>{{totals.grandTotal.balance | currency}}</td>
    <td ng-if="revised"></td>
    <td ng-if="revised">{{totals.grandTotal.cqPaid | currency}}</td>
    <td ng-if="revised">{{totals.grandTotal.soldFor | currency}}</td>
    <td>{{totals.grandTotal.verifiedBalance | currency}}</td>
    <td ng-if="!revised"></td>
    <td ng-if="admin && !revised"></td>
    <td ng-if="corporate">{{totals.grandTotal.buyAmount | currency}}</td>
    <td ng-if="corporate"></td>
    <td ng-if="corporate">{{totals.grandTotal.saleAfterMargin | currency}}</td>
    <td ng-if="admin">{{totals.grandTotal.serviceFee | currency}}</td>
    <td>{{totals.grandTotal.netAmount | currency}}</td>
    <td ng-if="corporate"></td>
    <td></td>
    <td ng-if="revised"></td>
    <td></td>
    <td ng-if="!revised"></td>
    <td ng-if="revised"></td>
    <td ng-if="revised"></td>
    <td ng-if="revised"></td>
  </tr>
  </tbody>
  <tfoot>
  <tr>
    <td colspan="5" class="text-center">
      <div st-pagination="" st-items-by-page="displayData.perPage" st-page-change="changePage({newPage: newPage})"></div>
    </td>
  </tr>
  </tfoot>
</table>

<!--Mass update-->
<cq-modal modal-id="mass-update-confirm" submit-button="massUpdate()" modal-title="Mass update selected cards?"></cq-modal>
<cq-modal modal-id="mass-update-success" hide-submit="true" modal-title="Mass update successful"></cq-modal>
<cq-modal modal-id="mass-update-failure" hide-submit="true" modal-title="Mass update failed"></cq-modal>
