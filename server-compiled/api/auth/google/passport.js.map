{"version":3,"sources":["api/auth/google/passport.js"],"names":["passport","require","GoogleStrategy","OAuth2Strategy","exports","setup","User","config","use","clientID","google","clientSecret","callbackURL","accessToken","refreshToken","profile","done","findOne","id","err","user","name","displayName","email","emails","value","role","username","provider","_json","save"],"mappings":";;AAAA,IAAMA,WAAWC,QAAQ,UAAR,CAAjB;AACA,IAAMC,iBAAiBD,QAAQ,uBAAR,EAAiCE,cAAxD;;AAEAC,QAAQC,KAAR,GAAgB,UAAUC,IAAV,EAAgBC,MAAhB,EAAwB;AACtCP,WAASQ,GAAT,CAAa,IAAIN,cAAJ,CAAmB;AAC5BO,cAAUF,OAAOG,MAAP,CAAcD,QADI;AAE5BE,kBAAcJ,OAAOG,MAAP,CAAcC,YAFA;AAG5BC,iBAAaL,OAAOG,MAAP,CAAcE;AAHC,GAAnB,EAKX,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6CC,IAA7C,EAAmD;AACjDV,SAAKW,OAAL,CAAa;AACX,mBAAaF,QAAQG;AADV,KAAb,EAEG,UAASC,GAAT,EAAcC,IAAd,EAAoB;AACrB,UAAI,CAACA,IAAL,EAAW;AACTA,eAAO,IAAId,IAAJ,CAAS;AACde,gBAAMN,QAAQO,WADA;AAEdC,iBAAOR,QAAQS,MAAR,CAAe,CAAf,EAAkBC,KAFX;AAGdC,gBAAM,MAHQ;AAIdC,oBAAUZ,QAAQY,QAJJ;AAKdC,oBAAU,QALI;AAMdlB,kBAAQK,QAAQc;AANF,SAAT,CAAP;AAQAT,aAAKU,IAAL,CAAU,UAASX,GAAT,EAAc;AACtB,cAAIA,GAAJ,EAAS,OAAOH,KAAKG,GAAL,CAAP;AACTH,eAAKG,GAAL,EAAUC,IAAV;AACD,SAHD;AAID,OAbD,MAaO;AACL,eAAOJ,KAAKG,GAAL,EAAUC,IAAV,CAAP;AACD;AACF,KAnBD;AAoBD,GA1BU,CAAb;AA4BD,CA7BD","file":"api/auth/google/passport.js","sourcesContent":["const passport = require('passport');\nconst GoogleStrategy = require('passport-google-oauth').OAuth2Strategy;\n\nexports.setup = function (User, config) {\n  passport.use(new GoogleStrategy({\n      clientID: config.google.clientID,\n      clientSecret: config.google.clientSecret,\n      callbackURL: config.google.callbackURL\n    },\n    function(accessToken, refreshToken, profile, done) {\n      User.findOne({\n        'google.id': profile.id\n      }, function(err, user) {\n        if (!user) {\n          user = new User({\n            name: profile.displayName,\n            email: profile.emails[0].value,\n            role: 'user',\n            username: profile.username,\n            provider: 'google',\n            google: profile._json\n          });\n          user.save(function(err) {\n            if (err) return done(err);\n            done(err, user);\n          });\n        } else {\n          return done(err, user);\n        }\n      });\n    }\n  ));\n};\n"],"sourceRoot":"/home/ubuntu14/works/webstromProjects/gcmgr/gulp/es6"}