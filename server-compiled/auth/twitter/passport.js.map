{"version":3,"sources":["auth/twitter/passport.js"],"names":["exports","setup","User","config","passport","require","TwitterStrategy","Strategy","use","consumerKey","twitter","clientID","consumerSecret","clientSecret","callbackURL","token","tokenSecret","profile","done","findOne","id","err","user","name","displayName","username","role","provider","_json","save"],"mappings":";;AAAAA,QAAQC,KAAR,GAAgB,UAAUC,IAAV,EAAgBC,MAAhB,EAAwB;AACtC,MAAMC,WAAWC,QAAQ,UAAR,CAAjB;AACA,MAAMC,kBAAkBD,QAAQ,kBAAR,EAA4BE,QAApD;;AAEAH,WAASI,GAAT,CAAa,IAAIF,eAAJ,CAAoB;AAC/BG,iBAAaN,OAAOO,OAAP,CAAeC,QADG;AAE/BC,oBAAgBT,OAAOO,OAAP,CAAeG,YAFA;AAG/BC,iBAAaX,OAAOO,OAAP,CAAeI;AAHG,GAApB,EAKb,UAASC,KAAT,EAAgBC,WAAhB,EAA6BC,OAA7B,EAAsCC,IAAtC,EAA4C;AAC1ChB,SAAKiB,OAAL,CAAa;AACX,wBAAkBF,QAAQG;AADf,KAAb,EAEG,UAASC,GAAT,EAAcC,IAAd,EAAoB;AACrB,UAAID,GAAJ,EAAS;AACP,eAAOH,KAAKG,GAAL,CAAP;AACD;AACD,UAAI,CAACC,IAAL,EAAW;AACTA,eAAO,IAAIpB,IAAJ,CAAS;AACdqB,gBAAMN,QAAQO,WADA;AAEdC,oBAAUR,QAAQQ,QAFJ;AAGdC,gBAAM,MAHQ;AAIdC,oBAAU,SAJI;AAKdjB,mBAASO,QAAQW;AALH,SAAT,CAAP;AAOAN,aAAKO,IAAL,CAAU,UAASR,GAAT,EAAc;AACtB,cAAIA,GAAJ,EAAS,OAAOH,KAAKG,GAAL,CAAP;AACTH,eAAKG,GAAL,EAAUC,IAAV;AACD,SAHD;AAID,OAZD,MAYO;AACL,eAAOJ,KAAKG,GAAL,EAAUC,IAAV,CAAP;AACD;AACF,KArBD;AAsBC,GA5BU,CAAb;AA8BD,CAlCD","file":"auth/twitter/passport.js","sourcesContent":["exports.setup = function (User, config) {\n  const passport = require('passport');\n  const TwitterStrategy = require('passport-twitter').Strategy;\n\n  passport.use(new TwitterStrategy({\n    consumerKey: config.twitter.clientID,\n    consumerSecret: config.twitter.clientSecret,\n    callbackURL: config.twitter.callbackURL\n  },\n  function(token, tokenSecret, profile, done) {\n    User.findOne({\n      'twitter.id_str': profile.id\n    }, function(err, user) {\n      if (err) {\n        return done(err);\n      }\n      if (!user) {\n        user = new User({\n          name: profile.displayName,\n          username: profile.username,\n          role: 'user',\n          provider: 'twitter',\n          twitter: profile._json\n        });\n        user.save(function(err) {\n          if (err) return done(err);\n          done(err, user);\n        });\n      } else {\n        return done(err, user);\n      }\n    });\n    }\n  ));\n};\n"],"sourceRoot":"/home/ubuntu14/works/webstromProjects/gcmgr/gulp/es6"}