{"version":3,"sources":["auth/forgot/mailer.js"],"names":["helper","require","mail","fs","path","module","exports","setApiKey","key","apiKey","sendResetPasswordEmail","to","data","callback","from","Email","subject","templatePath","resolve","__dirname","readFile","err","template","replace","resetLink","content","Content","Mail","sg","request","emptyRequest","method","body","toJSON","API"],"mappings":";;AAAA,IAAMA,SAASC,QAAQ,UAAR,EAAoBC,IAAnC;AACA,IAAMC,KAAKF,QAAQ,IAAR,CAAX;AACA,IAAMG,OAAOH,QAAQ,MAAR,CAAb;;AAEAI,OAAOC,OAAP,GAAiB;AACf;;;;;AAKAC,aAAW,mBAAUC,GAAV,EAAe;AACxB,SAAKC,MAAL,GAAcD,GAAd;AACD,GARc;AASf;;;;;;;AAOAE,0BAAwB,gCAAUC,EAAV,EAAcC,IAAd,EAAoBC,QAApB,EAA8B;AAAA;;AACpD,QAAMC,OAAO,IAAId,OAAOe,KAAX,CAAiB,uBAAjB,CAAb;AACAJ,SAAK,IAAIX,OAAOe,KAAX,CAAiBJ,EAAjB,CAAL;AACA,QAAMK,UAAU,qBAAhB;AACA,QAAMC,eAAeb,KAAKc,OAAL,CAAaC,SAAb,EAAwB,qCAAxB,CAArB;AACAhB,OAAGiB,QAAH,CAAYH,YAAZ,EAA0B,MAA1B,EAAkC,UAACI,GAAD,EAAMC,QAAN,EAAmB;AACnDA,iBAAWA,SAASC,OAAT,CAAiB,oBAAjB,EAAuCX,KAAKY,SAA5C,CAAX;AACA,UAAMC,UAAU,IAAIzB,OAAO0B,OAAX,CAAmB,WAAnB,EAAgCJ,QAAhC,CAAhB;AACA,UAAMpB,OAAO,IAAIF,OAAO2B,IAAX,CAAgBb,IAAhB,EAAsBE,OAAtB,EAA+BL,EAA/B,EAAmCc,OAAnC,CAAb;;AAEA,UAAMG,KAAK3B,QAAQ,UAAR,EAAoB,MAAKQ,MAAzB,CAAX;AACA,UAAMoB,UAAUD,GAAGE,YAAH,CAAgB;AAC9BC,gBAAQ,MADsB;AAE9B3B,cAAM,eAFwB;AAG9B4B,cAAM9B,KAAK+B,MAAL;AAHwB,OAAhB,CAAhB;;AAMAL,SAAGM,GAAH,CAAOL,OAAP,EAAgBhB,QAAhB;AACD,KAbD;AAcD;AAnCc,CAAjB","file":"auth/forgot/mailer.js","sourcesContent":["const helper = require('sendgrid').mail;\nconst fs = require('fs');\nconst path = require('path');\n\nmodule.exports = {\n  /**\n   * Set SendGrid API key\n   *\n   * @param {String} key\n   */\n  setApiKey: function (key) {\n    this.apiKey = key;\n  },\n  /**\n   * Send reset password email\n   *\n   * @param {String} to\n   * @param {{resetLink: String}} data\n   * @param {Function} callback\n   */\n  sendResetPasswordEmail: function (to, data, callback) {\n    const from = new helper.Email('noreply@cardquiry.com');\n    to = new helper.Email(to);\n    const subject = 'Reset Your Password';\n    const templatePath = path.resolve(__dirname, '../../../mail_templates/forgot.html');\n    fs.readFile(templatePath, 'utf8', (err, template) => {\n      template = template.replace(/{{{RESET_LINK}}}/gi, data.resetLink);\n      const content = new helper.Content('text/html', template);\n      const mail = new helper.Mail(from, subject, to, content);\n\n      const sg = require('sendgrid')(this.apiKey);\n      const request = sg.emptyRequest({\n        method: 'POST',\n        path: '/v3/mail/send',\n        body: mail.toJSON()\n      });\n\n      sg.API(request, callback);\n    });\n  }\n};\n"],"sourceRoot":"/home/ubuntu14/works/webstromProjects/gcmgr/gulp/es6"}