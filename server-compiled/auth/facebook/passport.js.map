{"version":3,"sources":["auth/facebook/passport.js"],"names":["passport","require","FacebookStrategy","Strategy","exports","setup","User","config","use","clientID","facebook","clientSecret","callbackURL","accessToken","refreshToken","profile","done","findOne","id","err","user","name","displayName","email","emails","value","role","username","provider","_json","save"],"mappings":";;AAAA,IAAMA,WAAWC,QAAQ,UAAR,CAAjB;AACA,IAAMC,mBAAmBD,QAAQ,mBAAR,EAA6BE,QAAtD;;AAEAC,QAAQC,KAAR,GAAgB,UAAUC,IAAV,EAAgBC,MAAhB,EAAwB;AACtCP,WAASQ,GAAT,CAAa,IAAIN,gBAAJ,CAAqB;AAC9BO,cAAUF,OAAOG,QAAP,CAAgBD,QADI;AAE9BE,kBAAcJ,OAAOG,QAAP,CAAgBC,YAFA;AAG9BC,iBAAaL,OAAOG,QAAP,CAAgBE;AAHC,GAArB,EAKX,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6CC,IAA7C,EAAmD;AACjDV,SAAKW,OAAL,CAAa;AACX,qBAAeF,QAAQG;AADZ,KAAb,EAGA,UAASC,GAAT,EAAcC,IAAd,EAAoB;AAClB,UAAID,GAAJ,EAAS;AACP,eAAOH,KAAKG,GAAL,CAAP;AACD;AACD,UAAI,CAACC,IAAL,EAAW;AACTA,eAAO,IAAId,IAAJ,CAAS;AACde,gBAAMN,QAAQO,WADA;AAEdC,iBAAOR,QAAQS,MAAR,CAAe,CAAf,EAAkBC,KAFX;AAGdC,gBAAM,MAHQ;AAIdC,oBAAUZ,QAAQY,QAJJ;AAKdC,oBAAU,UALI;AAMdlB,oBAAUK,QAAQc;AANJ,SAAT,CAAP;AAQAT,aAAKU,IAAL,CAAU,UAASX,GAAT,EAAc;AACtB,cAAIA,GAAJ,EAAS,OAAOH,KAAKG,GAAL,CAAP;AACTH,eAAKG,GAAL,EAAUC,IAAV;AACD,SAHD;AAID,OAbD,MAaO;AACL,eAAOJ,KAAKG,GAAL,EAAUC,IAAV,CAAP;AACD;AACF,KAvBD;AAwBD,GA9BU,CAAb;AAgCD,CAjCD","file":"auth/facebook/passport.js","sourcesContent":["const passport = require('passport');\nconst FacebookStrategy = require('passport-facebook').Strategy;\n\nexports.setup = function (User, config) {\n  passport.use(new FacebookStrategy({\n      clientID: config.facebook.clientID,\n      clientSecret: config.facebook.clientSecret,\n      callbackURL: config.facebook.callbackURL\n    },\n    function(accessToken, refreshToken, profile, done) {\n      User.findOne({\n        'facebook.id': profile.id\n      },\n      function(err, user) {\n        if (err) {\n          return done(err);\n        }\n        if (!user) {\n          user = new User({\n            name: profile.displayName,\n            email: profile.emails[0].value,\n            role: 'user',\n            username: profile.username,\n            provider: 'facebook',\n            facebook: profile._json\n          });\n          user.save(function(err) {\n            if (err) return done(err);\n            done(err, user);\n          });\n        } else {\n          return done(err, user);\n        }\n      })\n    }\n  ));\n};\n"],"sourceRoot":"/home/ubuntu14/works/webstromProjects/gcmgr/gulp/es6"}